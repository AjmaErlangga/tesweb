<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Editor TTD - Galactic Edition (Checklist Locked)</title>
  
  <!-- Library Inti (External CDNs) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PDF-Lib (Global Script) -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <!-- Font Awesome -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>

  <!-- Style Modular -->
  <link rel="stylesheet" href="style.css">
</head>
<body class="antialiased">

<!-- EFEK VISUAL -->
<canvas id="constellation-canvas"></canvas>
<div id="spotlight"></div>

<header class="backdrop-blur-md shadow-sm sticky top-0 z-40 border-b initial-hidden">
    <div class="flex items-center justify-between px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex items-center space-x-3">
            <img id="app-icon" src="https://ajmaerlangga.github.io/image/icon_merge_purple.png" class="h-8 w-8" alt="App Icon">
            <h1 class="text-2xl font-bold">PDF Editor</h1>
        </div>
        <button id="settings-button-editor" class="p-2 rounded-full transition-all duration-300 hover:rotate-45" onmouseover="this.style.backgroundColor='var(--border-color)'" onmouseout="this.style.backgroundColor='transparent'"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
    </div>
</header>

<div class="flex flex-col lg:flex-row h-[calc(100vh-68px)]">
  
  <!-- Konten Utama (Preview PDF) -->
  <main id="main-content" class="flex flex-col flex-1 p-4 sm:p-6 lg:p-8 transition-all duration-300 initial-hidden overflow-y-auto" style="animation-delay: 0.2s;">
      
      <div id="dropzone" class="col-span-full flex flex-col items-center justify-center h-full rounded-xl border-2 border-dashed p-12 text-center transition-all duration-300 pulsing-border">
          <img id="dropzone-icon" src="https://ajmaerlangga.github.io/image/icon_merge_purple.png" class="h-20 w-20 mb-4" alt="Dropzone Icon">
          <h3 class="text-2xl font-semibold">Drag & Drop PDF Anda ke Sini</h3>
          <p class="mt-2" style="color: var(--text-secondary);">atau</p>
          <button onclick="triggerFileInput()" class="shimmer-button mt-4 text-white px-6 py-2 rounded-lg transition-all duration-300 font-semibold shadow-md active:scale-95" style="background-image: linear-gradient(to right, var(--accent-start), var(--accent-end));">Pilih File</button>
      </div>

      <!-- Preview Area -->
      <div id="preview-section" class="hidden flex-grow flex flex-col h-full overflow-hidden relative">
          
          <!-- Draggable Checklist Widget -->
          <div id="ji-checklist-box" class="hidden">
            <div id="checklist-header">
               <h4 class="font-bold text-sm uppercase tracking-wider text-white"><i class="fas fa-grip-vertical mr-2 opacity-50"></i> Note: Cek Struktur JI</h4>
            </div>
            <div class="checklist-content">
              <label class="checklist-item">
                <input type="checkbox" class="modern-checkbox"> <span>Job Name</span>
              </label>
              <label class="checklist-item">
                <input type="checkbox" class="modern-checkbox"> <span>Size</span>
              </label>
              <label class="checklist-item">
                <input type="checkbox" class="modern-checkbox"> <span>SKU Name</span>
              </label>
              <label class="checklist-item">
                <input type="checkbox" class="modern-checkbox"> <span>Quantity Per SKU</span>
              </label>
              <label class="checklist-item">
                <input type="checkbox" class="modern-checkbox"> <span>Total Quantity</span>
              </label>
              <label class="checklist-item">
                <input type="checkbox" class="modern-checkbox"> <span>Percentage</span>
              </label>
              <!-- NEW CHECKLIST ITEM ADDED HERE -->
              <label class="checklist-item">
                <input type="checkbox" class="modern-checkbox"> <span>Note Tambahan</span>
              </label>

              <!-- CRB Toggle Option -->
              <div class="crb-group">
                <span class="crb-label">CRB</span>
                <div class="toggle-container">
                  <label class="flex-1">
                    <input type="radio" name="crb-status" class="toggle-input" value="yes">
                    <div class="toggle-option yes-opt">YA</div>
                  </label>
                  <label class="flex-1">
                    <input type="radio" name="crb-status" class="toggle-input" value="no">
                    <div class="toggle-option no-opt">TIDAK</div>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div id="pdf-loading-overlay" class="hidden absolute inset-0 z-50 flex flex-col items-center justify-center">
              <div class="spinner-large"></div>
              <p class="mt-4 text-lg" style="color: var(--text-secondary);">Memuat PDF...</p>
          </div>

          <div class="pdf-main">
            <div class="pdf-pages-wrapper" id="pdf-pages-wrapper"></div>
          </div>
      </div>

  </main>

  <!-- Sidebar -->
  <aside class="w-full lg:w-96 backdrop-blur-md p-6 flex flex-col border-l initial-hidden h-full overflow-hidden" style="animation-delay: 0.4s;">
    
      <div class="flex flex-col flex-grow min-h-0 space-y-4 overflow-y-auto sidebar-content-scroll">
          
          <input type="file" id="pdf-file" accept="application/pdf" class="hidden" />
          <input type="file" id="sig-file" accept="image/png, image/jpeg" class="hidden" multiple />
          
          <h3 class="text-sm font-semibold mb-2 uppercase tracking-wider" style="color: var(--text-secondary);">Galeri Tanda Tangan</h3>
                
          <button id="upload-signature-btn" onclick="triggerSignatureUpload()" class="shimmer-button w-full px-4 py-2 rounded-lg transition-all duration-300 flex items-center justify-center font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 active:scale-95" style="background-color: var(--button-secondary-bg); color: var(--text-primary); --tw-ring-offset-color: var(--bg-color); --tw-ring-color: var(--accent-start);">
              <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
              Unggah Tanda Tangan
          </button>

          <div id="signature-gallery" class="mt-4 overflow-y-auto"></div>
          
          <div class="mt-4 pt-4 border-t" style="border-color: var(--border-color);">
              <h3 class="text-sm font-semibold mb-2 uppercase tracking-wider" style="color: var(--text-secondary);">Timestamp</h3>
              <select id="user" class="hidden">
                <option value="0">--Pilih--</option>
                <option value="sss">Sales Support</option>
                <option value="sales">Sales</option>
              </select>
              <div id="timestamp-controls">
                  <button class="timestamp-btn" data-type="SSS">SSS</button>
                  <button class="timestamp-btn" data-type="SALES">SALES</button>
                  <button class="timestamp-btn" data-type="NONE">Nonaktif</button>
              </div>
          </div>
          
          <div class="mt-4"> 
            <h3 class="flex justify-between items-center cursor-pointer collapsed p-3 rounded-lg" id="shapes-header" style="background-color: var(--button-secondary-bg); border: 1px solid var(--border-color);">
              <span class="text-sm font-semibold uppercase tracking-wider" style="color: var(--text-secondary);">Shapes</span>
              <i id="shapes-chevron" class="fas fa-chevron-down transition-transform duration-200" style="color: var(--text-secondary);"></i>
            </h3>
            <div id="shapes-content" style="display: none;" class="formatting-section mt-2">
              <label class="block font-medium mb-1 text-sm" style="color: var(--text-secondary);">Tipe Shape:</label>
              <div id="shape-buttons" class="flex gap-2">
                <button type="button" class="shape-btn active-btn" data-shape="rectangle" title="Rectangle"><i class="fas fa-square"></i></button>
                <button type="button" class="shape-btn" data-shape="ellipse" title="Ellipse"><i class="fas fa-circle"></i></button>
                <button type="button" class="shape-btn" data-shape="line" title="Line"><i class="fas fa-minus"></i></button>
              </div>
              <label class="block font-medium mb-1 text-sm mt-2" style="color: var(--text-secondary);">Warna Shape:</label>
              <input type="color" id="shape-color" value="#f43f5e">
              <button id="btnToggleShape" class="action-button action-button-secondary mt-2">Add Shape</button>
            </div>
          </div>
          
          <div class="formatting-section" id="text-formatting-section">
            <h3 class="text-sm font-semibold uppercase tracking-wider mb-2" style="color: var(--accent-start);">Format Teks</h3>
            <div class="mb-2">
              <label class="text-sm" style="color: var(--text-secondary);">Jenis Font:</label>
              <select id="font-family">
                <option value="Helvetica">Helvetica</option>
                <option value="Times Roman">Times Roman</option>
                <option value="Courier">Courier</option>
                <option value="Verdana">Verdana</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="text-sm" style="color: var(--text-secondary);">Ukuran Font:</label>
              <input type="number" id="font-size" value="12" min="1" />
            </div>
            <div class="mb-2">
              <label class="text-sm" style="color: var(--text-secondary);">Warna Teks:</label>
              <input type="color" id="font-color" value="#000000">
            </div>
            <div class="formatting-buttons">
              <button id="btn-bold">B</button>
              <button id="btn-italic">I</button>
              <button id="btn-underline">U</button>
              <button id="btn-align-left"><i class="fas fa-align-left"></i></button>
              <button id="btn-align-center"><i class="fas fa-align-center"></i></button>
              <button id="btn-align-right"><i class="fas fa-align-right"></i></button>
            </div>
          </div>
      </div>
      
      <div class="mt-6 pt-6 border-t" style="border-color: var(--border-color);">
          <div class="mb-3">
            <label class="block text-sm font-medium" style="color: var(--text-secondary);">Nama Output PDF:</label>
            <input type="text" id="outputFileName" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 sm:text-sm" style="background-color: var(--input-bg); border-color: var(--border-color); color: var(--text-primary); --tw-ring-color: var(--accent-start);" placeholder="Modified_PDF">
          </div>
          
          <button id="btnDownload" class="action-button action-button-primary shimmer-button w-full py-3">
            <span id="mergeButtonText">Unduh PDF</span>
            <div id="mergeSpinner" class="spinner ml-2 hidden"></div>
          </button>
          
          <div class="flex items-center space-x-3 mt-4">
              <button onclick="triggerFileInput()" class="shimmer-button flex-1 px-4 py-2 rounded-lg transition-all duration-300 flex items-center justify-center font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 active:scale-95 hover:-translate-y-0.5" style="background-color: var(--button-secondary-bg); color: var(--text-primary); --tw-ring-offset-color: var(--bg-color); --tw-ring-color: var(--accent-start);">
                  <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2A8.001 8.001 0 0019.419 15m0 0H15" /></svg>
                  Ganti File
              </button>
              <button onclick="clearAllFiles()" class="bg-red-900/50 text-red-400 p-2.5 rounded-lg hover:bg-red-900 hover:text-red-300 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 active:scale-95 hover:scale-105" style="--tw-ring-offset-color: var(--bg-color); --tw-ring-color: #ef4444;" title="Hapus PDF">
                  <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
              </button>
          </div>

      </div>
  </aside>
</div>

<div class="pdf-controls">
  <button id="btnZoomOut" title="Zoom Out"><i class="fas fa-search-minus"></i></button>
  <input type="number" id="zoomInput" value="100" min="10" max="400" step="5" />%
  <button id="btnZoomIn" title="Zoom In"><i class="fas fa-search-plus"></i></button>
  <button id="btnUndo" class="gray-btn" title="Undo"><i class="fas fa-undo"></i></button>
  <button id="btnRedo" class="gray-btn" title="Redo"><i class="fas fa-redo"></i></button>
  <button id="btnPanMode" class="gray-btn" title="Pan Mode"><i class="fas fa-hand-paper"></i></button>
  <button id="btnPrevPage" title="Halaman sebelumnya"><i class="fas fa-chevron-up"></i></button>
  <input type="number" id="currentPageInput" value="1" min="1" title="Pilih halaman" />
  <span class="mx-1 text-sm" style="color: var(--text-secondary);">/ <span id="totalPagesSpan">1</span></span>
  <button id="btnNextPage" title="Halaman berikutnya"><i class="fas fa-chevron-down"></i></button>
</div>

<div id="custom-context-menu" class="custom-context-menu">
  <ul><li id="context-copy-all">Copy ke Semua Halaman</li></ul>
</div>

<div id="settings-modal-container" class="modal-container hidden fixed inset-0 z-[10000] flex items-center justify-center p-4">
  <div id="settings-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm opacity-0"></div>
  <div id="settings-modal-content" class="w-full max-w-sm rounded-xl border p-6 shadow-2xl opacity-0 -translate-y-4 relative" style="background-color: var(--card-color); border-color: var(--border-color);">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-bold">Theme Settings</h2>
      <button id="close-settings-button" class="p-1 rounded-full transition-colors" style="color: var(--text-secondary);" onmouseover="this.style.backgroundColor='var(--border-color)'" onmouseout="this.style.backgroundColor='transparent'"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
    </div>
    <div class="space-y-4">
      <div class="flex items-center justify-between"><label class="text-sm">Mode</label><div class="flex items-center p-1 rounded-md" style="background-color: var(--button-secondary-bg);"><button id="theme-dark-button" class="px-3 py-1 text-sm rounded-md transition-colors">Dark</button><button id="theme-light-button" class="px-3 py-1 text-sm rounded-md transition-colors">Light</button></div></div>
      <div class="flex items-center justify-between"><label class="text-sm">Accent Color</label><div id="accent-color-picker" class="flex space-x-3"><button class="w-6 h-6 rounded-full transition-all" style="background-image: linear-gradient(to right, var(--accent-purple-start), var(--accent-purple-end));" data-color-name="purple"></button><button class="w-6 h-6 rounded-full transition-all" style="background-image: linear-gradient(to right, var(--accent-blue-start), var(--accent-blue-end));" data-color-name="blue"></button><button class="w-6 h-6 rounded-full transition-all" style="background-image: linear-gradient(to right, var(--accent-emerald-start), var(--accent-emerald-end));" data-color-name="emerald"></button><button class="w-6 h-6 rounded-full transition-all" style="background-image: linear-gradient(to right, var(--accent-rose-start), var(--accent-rose-end));" data-color-name="rose"></button></div></div>
      
      <div class="flex items-center justify-between pt-4 border-t" style="border-color: var(--border-color);">
        <label class="text-sm">Notifikasi & Checklist</label>
        <div class="flex items-center p-1 rounded-md" style="background-color: var(--button-secondary-bg);">
          <button id="ji-notify-on" class="px-3 py-1 text-sm rounded-md transition-colors">Aktif</button>
          <button id="ji-notify-off" class="px-3 py-1 text-sm rounded-md transition-colors">Nonaktif</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="ji-confirm-modal-container" class="modal-container hidden fixed inset-0 z-[10001] flex items-center justify-center p-4">
  <div id="ji-confirm-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm opacity-0"></div>
  <div id="ji-confirm-modal-content" class="w-full max-w-sm rounded-xl border p-6 shadow-2xl opacity-0 -translate-y-4 relative" style="background-color: var(--card-color); border-color: var(--border-color);">
    <h2 class="text-xl font-bold mb-4">Konfirmasi Unduh</h2>
    <p class="mb-6" style="color: var(--text-secondary);">Apakah Anda yakin JI sudah sesuai dan siap untuk diunduh?</p>
    <div class="flex space-x-4">
      <button id="ji-confirm-cek-ulang" class="action-button action-button-secondary flex-1 py-2">Cek Ulang</button>
      <button id="ji-confirm-sesuai" class="action-button action-button-primary flex-1 py-2 shimmer-button">Sesuai</button>
    </div>
  </div>
</div>

<div id="toast-container"></div>

<!-- Logic Modular -->
<script type="module" src="script.js"></script>

</body>
</html>
